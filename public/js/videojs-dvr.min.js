!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):e.videojsDvr=t(e.videojs)}(this,(function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},r={},n=Object.freeze({default:r}),o=n&&r||n,i=void 0!==t?t:"undefined"!=typeof window?window:{},a="undefined"!=typeof document?document:i["__GLOBAL_DOCUMENT_CACHE@4"]||(i["__GLOBAL_DOCUMENT_CACHE@4"]=o);function s(e){this.value=e}function l(e){var t,r;function n(t,r){try{var i=e[t](r),a=i.value;a instanceof s?Promise.resolve(a.value).then((function(e){n("next",e)}),(function(e){n("throw",e)})):o(i.done?"return":"normal",i.value)}catch(t){o("throw",t)}}function o(e,o){switch(e){case"return":t.resolve({value:o,done:!0});break;case"throw":t.reject(o);break;default:t.resolve({value:o,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function(e,o){return new Promise((function(i,a){var s={key:e,arg:o,resolve:i,reject:a,next:null};r?r=r.next=s:(t=r=s,n(e,o))}))},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(l.prototype[Symbol.asyncIterator]=function(){return this}),l.prototype.next=function(e){return this._invoke("next",e)},l.prototype.throw=function(e){return this._invoke("throw",e)},l.prototype.return=function(e){return this._invoke("return",e)};var u={startTime:0,timeLive:3600},p=0,c=u.timeLive,d=e.registerPlugin||e.plugin,f=e.getComponent("Button"),h=e.getComponent("Component"),v=e.getComponent("ProgressControl"),y=v.getComponent("SeekBar"),_=v.getComponent("PlayProgressBar"),m=e.getComponent("MouseTimeDisplay");function b(t){var r=this;t=t||u,this.on("timeupdate",(function(e){!function(e){var t=e.seekable();t&&t.length&&(t.end(0)-e.currentTime()<20?e.controlBar.liveButton.addClass("onair"):e.controlBar.liveButton.removeClass("onair"),e.duration(e.seekable().end(0)),p=p||(c=e.seekable().end(0)))}(r)})),this.on("pause",(function(e){r.controlBar.liveButton.removeClass("onair")})),this.ready((function(){!function(e){e.addClass("vjs-dvr"),e.controlBar.addClass("vjs-dvr-control-bar"),e.controlBar.progressControl.seekBar.__proto__.__proto__.update=function(){if(this.el_){var e=void 0;e="VolumeBar"===this.name_?this.getPercent():1-(this.player_.duration()-this.player_.currentTime())/c;var t=this.bar;if(t){("number"!=typeof e||e!=e||e<0||e===1/0)&&(e=0),1<e&&(e=1);var r=(100*e).toFixed(2)+"%",n=t.el().style;return 0!==e&&(this.vertical()?n.height=r:n.width=r),e}}},e.controlBar.progressControl&&e.controlBar.progressControl.addClass("vjs-dvr-progress-control"),e.controlBar.liveButton=e.controlBar.addChild("liveButton"),e.controlBar.el().insertBefore(e.controlBar.liveButton.el(),e.controlBar.progressControl.el())}(r,e.mergeOptions(u,t))}))}v.getComponent("LoadProgressBar").prototype.update=function(e){function t(e,t){var r=e/t||0;return 100*(1<=r?1:r)+"%"}var r=this.player_.buffered(),n=this.player_.duration(),o=this.player_.bufferedEnd(),i=this.partEls_;0!==t(o,n)&&(this.el_.style.width=t(o,n));for(var s=0;s<r.length;s++){var l=r.start(s),u=r.end(s),p=i[s];p||(p=this.el_.appendChild(a.createElement("div")),i[s]=p),0!==t(l,o)&&(p.style.left=t(l,o)),0!==t(u-l,o)&&(p.style.width=t(u-l,o))}for(var c=i.length;c>r.length;c--)this.el_.removeChild(i[c-1]);i.length=r.length},y.prototype.update_=function(t,r){var n=this.player_.duration(),o=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();this.el_.setAttribute("aria-valuenow",(100*r).toFixed(2)),n!==Number.POSITIVE_INFINITY&&this.el_.setAttribute("aria-valuetext","-"+e.formatTime(n-o,n)),this.bar.update(e.dom.getBoundingClientRect(this.el_),r)},y.prototype.handleMouseMove=function(e){var t=1-this.calculateDistance(e),r=this.player_.seekable().end(0)-t*c;r===this.player_.duration()&&(r-=.1),this.player_.currentTime(r),this.update()},_.prototype.update=function(t,r){var n=this,o=this.player_.duration();this.rafId_&&this.cancelAnimationFrame(this.rafId_),this.rafId_=this.requestAnimationFrame((function(){var i=n.player_.scrubbing()?n.player_.getCache().currentTime:n.player_.currentTime(),a=e.formatTime(o-i,o);0!==r&&o!==Number.POSITIVE_INFINITY&&n.getChild("timeTooltip").update(t,r,"-"+a)}))},m.prototype.update=function(t,r){var n=this;this.rafId_&&this.cancelAnimationFrame(this.rafId_),this.rafId_=this.requestAnimationFrame((function(){var o=e.formatTime(c-r*c,c);n.el_.style.left=t.width*r+"px",0!==r&&n.player_.duration()!==Number.POSITIVE_INFINITY&&n.getChild("timeTooltip").update(t,r,"-"+o)}))};var C,g=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(B,C=f),B.prototype.buildCSSClass=function(){return"vjs-live-button "+C.prototype.buildCSSClass.call(this)},B.prototype.handleClick=function(e){var t=this.player_.seekable().end(0);this.player_.currentTime(t),this.player_.play()},B);function B(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,B);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,C.call(this,e,t));return r.el().innerHTML='<span class="liveCircle"></span><span class="liveText">LIVE</span>',e.paused()||r.addClass("onair"),r}return h.registerComponent("LiveButton",g),d("dvr",b),b.VERSION="1.4.0",b}));

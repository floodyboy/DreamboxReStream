!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):(e=e||self)["videojs-http-source-selector"]=t(e.videojs)}(this,(function(e){"use strict";function t(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var n=(e=e&&e.hasOwnProperty("default")?e.default:e).getComponent("MenuItem"),l=e.getComponent("Component"),i=function(e){function o(t,o){return o.selectable=!0,o.multiSelectable=!1,e.call(this,t,o)||this}t(o,e);var n=o.prototype;return n.handleClick=function(){var t=this.options_;console.log("Changing quality to:",t.label),e.prototype.handleClick.call(this);for(var o=this.player().qualityLevels(),n=0;n<o.length;n++)t.index==o.length||t.index==n?o[n].enabled=!0:o[n].enabled=!1},n.update=function(){var e=this.player().qualityLevels().selectedIndex;this.selected(this.options_.index==e)},o}(n);l.registerComponent("SourceMenuItem",i);var r=e.getComponent("MenuButton"),s=function(n){function l(t,l){var i;i=n.call(this,t,l)||this,r.apply(o(i),arguments);var s=i.player().qualityLevels();if(l&&l.default)if("low"==l.default)for(var a=0;a<s.length;a++)s[a].enabled=0==a;else if(l.default="high")for(a=0;a<s.length;a++)s[a].enabled=a==s.length-1;return i.player().qualityLevels().on(["change","addqualitylevel"],e.bind(o(i),i.update)),i}t(l,n);var s=l.prototype;return s.createEl=function(){return e.dom.createEl("div",{className:"vjs-http-source-selector vjs-menu-button vjs-menu-button-popup vjs-control vjs-button"})},s.buildCSSClass=function(){return r.prototype.buildCSSClass.call(this)+" vjs-icon-cog"},s.update=function(){return r.prototype.update.call(this)},s.createItems=function(){for(var e=[],t=this.player().qualityLevels(),o=[],n=0;n<t.length;n++){var l=t.length-(n+1),r=l===t.selectedIndex,s=""+l,a=l;t[l].height?(s=t[l].height+"p",a=parseInt(t[l].height,10)):t[l].bitrate&&(s=Math.floor(t[l].bitrate/1e3)+" kbps",a=parseInt(t[l].bitrate,10)),0<=o.indexOf(s)||(o.push(s),e.push(new i(this.player_,{label:s,index:l,selected:r,sortVal:a})))}return 1<t.length&&e.push(new i(this.player_,{label:"Auto",index:t.length,selected:!1,sortVal:99999})),e.sort((function(e,t){return e.options_.sortVal<t.options_.sortVal?1:e.options_.sortVal>t.options_.sortVal?-1:0})),e},l}(r),a={},u=function(t){var o=this;this.ready((function(){!function(t,o){t.addClass("vjs-http-source-selector"),console.log("videojs-http-source-selector initialized!"),console.log("player.techName_:"+t.techName_),"Html5"==t.techName_&&t.on(["loadedmetadata"],(function(o){if(t.qualityLevels(),e.log("loadmetadata event"),"undefined"==t.videojs_http_source_selector_initialized||1==t.videojs_http_source_selector_initialized)console.log("player.videojs_http_source_selector_initialized == true");else{console.log("player.videojs_http_source_selector_initialized == false"),t.videojs_http_source_selector_initialized=!0;var n=t.controlBar,l=n.getChild("fullscreenToggle").el();n.el().insertBefore(n.addChild("SourceMenuButton").el(),l)}}))}(o,e.mergeOptions(a,t))})),e.registerComponent("SourceMenuButton",s),e.registerComponent("SourceMenuItem",i)};return(e.registerPlugin||e.plugin)("httpSourceSelector",u),u.VERSION="1.1.6",u}));
